<!DOCTYPE html>
    <html>
        <head>
            <title>AaronH_LAB07</title>
            <meta charset="utf-8"/>
                  
            <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css">

            <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>

            <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
            <script src="https://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>

            <script src="https://dsps.lib.uiowa.edu/placing/public/leafletSlider-1.0.2/leaflet.SliderControl.min.js"></script>

            <script src="https://dsps.lib.uiowa.edu/placing/public/fuse-1.2.1/fuse.min.js"></script>
            <script src="https://dsps.lib.uiowa.edu/placing/public/leafletFuseSearch-noVersion/leafletfuse.js"></script>

            <link rel="stylesheet" href="https://dsps.lib.uiowa.edu/placing/public/leafletFuseSearch-noVersion/leafletfuse.css"/>

            <script src="./omadata.js"></script>

            <style>
                #map {width:100%; height:650px}
            </style>
        </head>

        <body>
            <div id="map"></div>

            <script>
                var basemap = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',{
                    attribution: '©OpenStreetMap ©CartoDB',
                    subdomains: 'abcd'
                });

                var map = L.map('map',{
                    center:[41.259944,-95.937057],
                    zoom:15,
                    layers:[basemap]
                });
                             
                var onEachFeature = function(feature, layer){
                    if (feature.properties){
                        var prop = feature.properties;

                        var popup = 
                            '<h3>'+prop['FNAME']+' '+prop['LNAME']+'</h3>'+
                            '<strong>Race/Gender: </strong>'+prop['RACE']+' '+prop['GENDER']+
                            '<br><strong>Occupation: </strong>'+prop['OCCUPATION']+
                            '<br><strong>Age: </strong>'+prop['AGE']+
                            '<br><strong>Family Estate: $</strong>'+prop['PERSREAL']+
                            '<br><strong>Fam. Real Estate: $</strong>'+prop['FAMREAL']+
                            '<br><strong>Address: </strong>'+prop['ADDRESS']+
                            '<br><br><i>details from Census Bureau and city directories</i>';

                        feature.layer = layer;
                        layer.bindPopup(popup,{maxWidth:"auto"});
                    }
                };

                var blueCircleMarkers = {
                    radius:4,
                    fillColor:"#00AEEF",
                    color:"#3978BF",
                    weight:1,
                    opacity:0.8,
                    fillOpacity:0.5
                };

                var orangeCircleMarkers = {
                    radius:5,
                    fillColor:"#ED1C24",
                    color:"#ED1C24",
                    weight:1,
                    opacity:1,
                    fillOpacity:0.7
                };

                var greenCircleMarkers = {
                    radius:5,
                    fillColor:"#ffff00",
                    color:"#286933",
                    weight:1,
                    opacity:1,
                    fillOpacity:0.7
                };

                var firstlayer = L.geoJson(omaJson,{
                    onEachFeature:onEachFeature,
                    pointToLayer:function(feature,latlng){
                        return L.circleMarker(latlng,blueCircleMarkers);
                    }
                }).addTo(map);
          
                 omaJson.forEach(function(f,i){
                    var years = [1910,1920,1930,1940];
                    f.properties.time = years[i % years.length];
                });

                var timelineLayer = L.geoJson(omaJson,{
                    onEachFeature:onEachFeature,
                    pointToLayer:function(feature,latlng){
                        return L.circleMarker(latlng,orangeCircleMarkers);
                    }
                });
                
                var searchLayer = L.geoJson(omaJson,{
                    onEachFeature:onEachFeature,
                    pointToLayer:function(feature,latlng){
                        return L.circleMarker(latlng,greenCircleMarkers);
                    }
                });
  
                var sliderControl = L.control.sliderControl({
                    position:"topright",
                    layer:timelineLayer,
                    range:true
                });

                map.addControl(sliderControl);
                sliderControl.startSlider();

                var searchOptions = {
                    position:'topleft',
                    title:'Search',
                    placeholder:'Search by name',
                    maxResultLength:5,
                    threshold:0.5,
                    keys:['FNAME','LNAME']
                };

                var searchControl = L.control.fuseSearch(searchOptions);

                searchControl.indexFeatures(
                    omaJson.map(function(f){return f.properties;}),
                    ['FNAME','LNAME']
                );

                searchControl.on('search:locationfound',function(e){
                    searchLayer.clearLayers();

                    var layer = L.geoJson(e.layer.feature,{
                        pointToLayer:function(feature,latlng){
                            return L.circleMarker(latlng,greenCircleMarkers);
                        },
                        onEachFeature:onEachFeature
                    });

                    searchLayer.addLayer(layer);
                    map.addLayer(searchLayer);

                    map.setView(e.latlng,17);
                });

                map.addControl(searchControl);

            </script>
        </body>
    </html>



